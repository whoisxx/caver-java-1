package com.klaytn.caver.common.abi;

import com.klaytn.caver.Caver;
import com.klaytn.caver.abi.EventValues;
import com.klaytn.caver.abi.TypeDecoder;
import com.klaytn.caver.abi.datatypes.*;
import com.klaytn.caver.abi.datatypes.generated.*;
import com.klaytn.caver.contract.Contract;
import com.klaytn.caver.contract.ContractIOType;
import org.junit.Test;
import org.junit.experimental.runners.Enclosed;
import org.junit.runner.RunWith;

import java.io.IOException;
import java.lang.reflect.InvocationTargetException;
import java.math.BigInteger;
import java.nio.charset.StandardCharsets;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;

import static org.junit.Assert.assertEquals;

@RunWith(Enclosed.class)
public class ABITest {
    static Caver caver = new Caver(Caver.DEFAULT_URL);
    public static class encodeFunctionSig {
        @Test
        public void encodeFunctionSignatureTest() {
            assertEquals("0xcdcd77c0", caver.abi.encodeFunctionSignature("baz(uint32,bool)"));
            assertEquals("0xfce353f6", caver.abi.encodeFunctionSignature("bar(bytes3[2])"));
            assertEquals("0xa5643bf2", caver.abi.encodeFunctionSignature("sam(bytes,bool,uint256[])"));
        }
    }

    public static class encodeEventSig {
        @Test
        public void encodeEventSignature() {
            assertEquals(
                    ("0x50cb9fe53daa9737b786ab3646f04d0150dc50ef4e75f59509d83667ad5adb20"),
                    caver.abi.encodeEventSignature("Deposit(address,hash256,uint256)"));

            assertEquals(
                    ("0x71e71a8458267085d5ab16980fd5f114d2d37f232479c245d523ce8d23ca40ed"),
                    caver.abi.encodeEventSignature("Notify(uint256,uint256)"));

        }
    }


    public static class encodeFunctionCall {
        @Test
        public void encodeFunctionCallTest() throws ClassNotFoundException, NoSuchMethodException, InstantiationException, IllegalAccessException, InvocationTargetException {
            String expected = "0xcdcd77c000000000000000000000000000000000000000000000000000000000000000450000000000000000000000000000000000000000000000000000000000000001";
            String functionSig = "baz(uint32,bool)";

            List<String> typeList = Arrays.asList("uint32", "bool");
            List<Object> params = Arrays.asList(69, true);

            assertEquals(expected, caver.abi.encodeFunctionCall(functionSig, typeList, params));
        }

        @Test
        public void encodeFunctionCallTest2() throws ClassNotFoundException, NoSuchMethodException, InstantiationException, IllegalAccessException, InvocationTargetException {
            String expected = "0xfce353f661626300000000000000000000000000000000000000000000000000000000006465660000000000000000000000000000000000000000000000000000000000";
            String functionSig = "bar(bytes3[2])";

            List<String> typeList = Arrays.asList("bytes3[2]");
            List<Object> params = new ArrayList<>();
            params.add(new byte[][] {"abc".getBytes(), "def".getBytes()});


            assertEquals(expected, caver.abi.encodeFunctionCall(functionSig, typeList, params));
        }

        @Test
        public void encodeFunctionCallTest3() throws ClassNotFoundException, NoSuchMethodException, InstantiationException, IllegalAccessException, InvocationTargetException {
            String expected = "0xa5643bf20000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000000464617665000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003";
            String functionSig = "sam(bytes,bool,uint256[])";

            List<String> typeList = Arrays.asList("bytes", "bool", "uint256[]");
            List<Object> params = Arrays.asList(
                    "dave".getBytes(),
                    true,
                    new BigInteger[] {BigInteger.valueOf(1), BigInteger.valueOf(2), BigInteger.valueOf(3)}
            );

            assertEquals(expected, caver.abi.encodeFunctionCall(functionSig, typeList, params));
        }
    }

    public static class encodeParameter {

        public void encodeParamTest(String params, Object object, String expected) throws ClassNotFoundException, NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException {
            assertEquals(expected, caver.abi.encodeParameter(params, object));
        }

        public void encodeParametersTest(List<String> params, List<Object> objects, String expected) throws ClassNotFoundException, NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException {
            assertEquals(expected, caver.abi.encodeParameters(params, objects));
        }

        @Test
        public void encodeBoolType() throws ClassNotFoundException, NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException {
            assertEquals("0000000000000000000000000000000000000000000000000000000000000000",
                    caver.abi.encodeParameter("bool", false));

            assertEquals("0000000000000000000000000000000000000000000000000000000000000001",
                    caver.abi.encodeParameter("bool", true));
        }

        @Test
        public void encodeUintType() throws ClassNotFoundException, NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException {
            assertEquals("00000000000000000000000000000000000000000000000000000000000000ff",
                    caver.abi.encodeParameter("uint", BigInteger.valueOf(255)));

            assertEquals(
                    "000000000000000000000000000000000000000000000000000000000000ffff",
                    caver.abi.encodeParameter("uint", BigInteger.valueOf(65535)));

            assertEquals(
                    "0000000000000000000000000000000000000000000000000000000000010000",
                    caver.abi.encodeParameter("uint", BigInteger.valueOf(65536)));

            assertEquals(
                    "0000000000000000000000000000000000000000000000ffffffffffffffffff",
                    caver.abi.encodeParameter("uint", new BigInteger("4722366482869645213695")));

            assertEquals(
                    "0000000000000000000000000000000000000000000000000000000000000000",
                    caver.abi.encodeParameter("uint", BigInteger.ZERO));
        }

        @Test
        public void encodeIntType() throws ClassNotFoundException, NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException {
            assertEquals(
                    ("0000000000000000000000000000000000000000000000000000000000000000"),
                    caver.abi.encodeParameter("int", BigInteger.ZERO));

            assertEquals(
                    ("000000000000000000000000000000000000000000000000000000000000007f"),
                    caver.abi.encodeParameter("int", 127));

            assertEquals(
                    ("0000000000000000000000000000000000000000000000000000000000007fff"),
                    caver.abi.encodeParameter("int", 32767));

            assertEquals(
                    ("000000000000000000000000000000000000000000000000000000007fffffff"),
                    caver.abi.encodeParameter("int", 2147483647));
        }

        @Test
        public void encodeAddressType() throws ClassNotFoundException, NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException {
            assertEquals(
                    ("000000000000000000000000be5422d15f39373eb0a97ff8c10fbd0e40e29338"),
                    caver.abi.encodeParameter("address", "0xbe5422d15f39373eb0a97ff8c10fbd0e40e29338"));
        }

        @Test
        public void encodeUtf8StringType() throws ClassNotFoundException, NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException {
            assertEquals(
                    ("0000000000000000000000000000000000000000000000000000000000000020"
                            + "000000000000000000000000000000000000000000000000000000000000000d"
                            + "48656c6c6f2c20776f726c642100000000000000000000000000000000000000"),
                    caver.abi.encodeParameter("string", "Hello, world!"));
        }

        @Test
        public void encodeStaticBytesType() throws ClassNotFoundException, NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException {
            assertEquals("0001020304050000000000000000000000000000000000000000000000000000",
                    caver.abi.encodeParameter("bytes6", new byte[] {0, 1, 2, 3, 4, 5}));

            assertEquals(
                    ("0000000000000000000000000000000000000000000000000000000000000000"),
                    caver.abi.encodeParameter("bytes1", new byte[] {0}));

            assertEquals(
                    ("7f00000000000000000000000000000000000000000000000000000000000000"),
                    caver.abi.encodeParameter("bytes1", new byte[] {127}));

            assertEquals(
                    ("6461766500000000000000000000000000000000000000000000000000000000"),
                    caver.abi.encodeParameter("bytes4", "dave".getBytes()));
        }

        @Test
        public void encodeDynamicBytesType() throws ClassNotFoundException, NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException {
            DynamicBytes dynamicBytes = new DynamicBytes(new byte[] {0, 1, 2, 3, 4, 5});
            assertEquals(
                    ("0000000000000000000000000000000000000000000000000000000000000020"
                        + "0000000000000000000000000000000000000000000000000000000000000006"
                        + "0001020304050000000000000000000000000000000000000000000000000000"),
                    caver.abi.encodeParameter("bytes", new byte[] {0,1,2,3,4,5}));

            assertEquals(
                    ("0000000000000000000000000000000000000000000000000000000000000020"
                        + "0000000000000000000000000000000000000000000000000000000000000001"
                        + "0000000000000000000000000000000000000000000000000000000000000000"),
                    caver.abi.encodeParameter("bytes", new byte[] {0}));

            assertEquals(
                    ("0000000000000000000000000000000000000000000000000000000000000020"
                        + "0000000000000000000000000000000000000000000000000000000000000004"
                        + "6461766500000000000000000000000000000000000000000000000000000000"),
                    caver.abi.encodeParameter("bytes", "dave".getBytes()));


            byte[] loremIpsum =  ("Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod "
                    + "tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim "
                    + "veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex "
                    + "ea commodo consequat. Duis aute irure dolor in reprehenderit in "
                    + "voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur "
                    + "sint occaecat cupidatat non proident, sunt in culpa qui officia "
                    + "deserunt mollit anim id est laborum.")
                    .getBytes();

            assertEquals(
                    ("0000000000000000000000000000000000000000000000000000000000000020"
                            + "00000000000000000000000000000000000000000000000000000000000001bd"
                            + "4c6f72656d20697073756d20646f6c6f722073697420616d65742c20636f6e73"
                            + "656374657475722061646970697363696e6720656c69742c2073656420646f20"
                            + "656975736d6f642074656d706f7220696e6369646964756e74207574206c6162"
                            + "6f726520657420646f6c6f7265206d61676e6120616c697175612e2055742065"
                            + "6e696d206164206d696e696d2076656e69616d2c2071756973206e6f73747275"
                            + "6420657865726369746174696f6e20756c6c616d636f206c61626f726973206e"
                            + "69736920757420616c697175697020657820656120636f6d6d6f646f20636f6e"
                            + "7365717561742e2044756973206175746520697275726520646f6c6f7220696e"
                            + "20726570726568656e646572697420696e20766f6c7570746174652076656c69"
                            + "7420657373652063696c6c756d20646f6c6f726520657520667567696174206e"
                            + "756c6c612070617269617475722e204578636570746575722073696e74206f63"
                            + "63616563617420637570696461746174206e6f6e2070726f6964656e742c2073"
                            + "756e7420696e2063756c706120717569206f666669636961206465736572756e"
                            + "74206d6f6c6c697420616e696d20696420657374206c61626f72756d2e000000"),
                    caver.abi.encodeParameter("bytes", loremIpsum));
        }

        @Test
        public void encodeDynamicArrayTest() throws ClassNotFoundException, NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException {
            assertEquals(
                    ("0000000000000000000000000000000000000000000000000000000000000020"
                            + "0000000000000000000000000000000000000000000000000000000000000003"
                            + "0000000000000000000000000000000000000000000000000000000000000001"
                            + "0000000000000000000000000000000000000000000000000000000000000002"
                            + "0000000000000000000000000000000000000000000000000000000000000003"),
                    caver.abi.encodeParameter("uint256[]", new BigInteger[] {BigInteger.valueOf(1), BigInteger.valueOf(2), BigInteger.valueOf(3)}));
        }

        @Test
        public void encodeStaticArrayTest() throws ClassNotFoundException, NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException {
            assertEquals("000000000000000000000000000000000000000000000000000000000000000a"
                    + "0000000000000000000000000000000000000000000000007fffffffffffffff",
                    caver.abi.encodeParameter("uint256[2]", new BigInteger[] {BigInteger.valueOf(10), BigInteger.valueOf(Long.MAX_VALUE)}));
        }

        @Test
        public void encodeArrayStaticType() throws ClassNotFoundException, NoSuchMethodException, InstantiationException, IllegalAccessException, InvocationTargetException {
            encodeParamTest("uint256[3]",
                    Arrays.asList(1,2,3),
                    "000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003"
            );

            encodeParamTest("bool[2]",
                    Arrays.asList(
                            true, false
                    ),
                    "00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000"
            );

            encodeParamTest("bytes3[2]",
                    Arrays.asList(
                            "abc".getBytes(StandardCharsets.UTF_8),
                            "def".getBytes(StandardCharsets.UTF_8)
                    ),"61626300000000000000000000000000000000000000000000000000000000006465660000000000000000000000000000000000000000000000000000000000"

            );

            encodeParamTest("uint256[]",
                    Arrays.asList(1,2,3),
                    "00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003"
            );

            encodeParamTest("bool[]",
                    Arrays.asList(
                            true, false
                    ),
                    "0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000"
            );

            encodeParamTest("bytes3[]",
                    Arrays.asList(
                            "abc".getBytes(StandardCharsets.UTF_8),
                            "def".getBytes(StandardCharsets.UTF_8)
                    ),"0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000261626300000000000000000000000000000000000000000000000000000000006465660000000000000000000000000000000000000000000000000000000000"

            );

            encodeParamTest("uint256[3][2]",
                    Arrays.asList(
                            Arrays.asList(1,2,3),
                            Arrays.asList(1,2,3)
                    ),
                    "000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003"
            );

            encodeParamTest("bool[2][2]",
                    Arrays.asList(
                            Arrays.asList(
                                    true, false
                            ),
                            Arrays.asList(
                                    true, false
                            )
                    ),
                    "0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000"
            );

            encodeParamTest("bytes3[2][1]",
                    Arrays.asList(Arrays.asList(
                            "abc".getBytes(StandardCharsets.UTF_8),
                            "def".getBytes(StandardCharsets.UTF_8)
                    )),
                    "61626300000000000000000000000000000000000000000000000000000000006465660000000000000000000000000000000000000000000000000000000000"
            );

            encodeParamTest("uint256[][2]",
                    Arrays.asList(
                            Arrays.asList(1,2,3),
                            Arrays.asList(1,2,3)
                    ),
                    "0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003"
            );

            encodeParamTest("bool[][2]",
                    Arrays.asList(
                            Arrays.asList(
                                    true, false
                            ),
                            Arrays.asList(
                                    true, false
                            )
                    ),
                    "0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000"
            );

            encodeParamTest("bytes3[][1]",
                    Arrays.asList(Arrays.asList(
                            "abc".getBytes(StandardCharsets.UTF_8),
                            "def".getBytes(StandardCharsets.UTF_8)
                    )),
                    "00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000261626300000000000000000000000000000000000000000000000000000000006465660000000000000000000000000000000000000000000000000000000000"

            );

            encodeParamTest("uint256[3][]",
                    Arrays.asList(
                            Arrays.asList(1,2,3),
                            Arrays.asList(1,2,3)
                    ),
                    "00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003"
            );

            encodeParamTest("bool[2][]",
                    Arrays.asList(
                            Arrays.asList(
                                    true, false
                            )
                    ),
                    "0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000"
            );

            encodeParamTest("bytes3[2][]",
                    Arrays.asList(Arrays.asList(
                            "abc".getBytes(StandardCharsets.UTF_8),
                            "def".getBytes(StandardCharsets.UTF_8)
                    )),
                    "0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000161626300000000000000000000000000000000000000000000000000000000006465660000000000000000000000000000000000000000000000000000000000"
            );

            encodeParamTest("uint256[][]",
                    Arrays.asList(
                            Arrays.asList(1,2,3),
                            Arrays.asList(1,2,3)
                    ),
                    "00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003"
            );

            encodeParamTest("bool[][]",
                    Arrays.asList(
                            Arrays.asList(
                                    true, false
                            ),
                            Arrays.asList(
                                    true, false
                            )
                    ),
                    "00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000"
            );

            encodeParamTest("bytes3[][]",
                    Arrays.asList(Arrays.asList(
                            "abc".getBytes(StandardCharsets.UTF_8),
                            "def".getBytes(StandardCharsets.UTF_8)
                    )),
                    "000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000261626300000000000000000000000000000000000000000000000000000000006465660000000000000000000000000000000000000000000000000000000000"
            );
        }

        @Test
        public void encodeArrayDynamicType() throws ClassNotFoundException, NoSuchMethodException, InstantiationException, IllegalAccessException, InvocationTargetException {
            encodeParamTest("string[2]",
                    Arrays.asList("aaa", "bbb"),
                    "0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616161000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036262620000000000000000000000000000000000000000000000000000000000"
            );

            encodeParamTest("bytes[2]",
                    Arrays.asList(
                            "abc".getBytes(StandardCharsets.UTF_8),
                            "def".getBytes(StandardCharsets.UTF_8)
                    ),
                    "0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616263000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036465660000000000000000000000000000000000000000000000000000000000"
            );

            encodeParamTest("string[]",
                    Arrays.asList("aaa", "bbb"),
                    "00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616161000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036262620000000000000000000000000000000000000000000000000000000000"
            );

            encodeParamTest("bytes[]",
                    Arrays.asList(
                            "abc".getBytes(StandardCharsets.UTF_8),
                            "def".getBytes(StandardCharsets.UTF_8)
                    ),
                    "00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616263000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036465660000000000000000000000000000000000000000000000000000000000"
            );


            encodeParamTest("string[2][2]",
                    Arrays.asList(
                            Arrays.asList("aaa", "bbb"),
                            Arrays.asList("aaa", "bbb")
                    ),
                    "000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616161000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036262620000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616161000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036262620000000000000000000000000000000000000000000000000000000000"
            );

            encodeParamTest("bytes[2][2]",
                    Arrays.asList(
                            Arrays.asList(
                                    "abc".getBytes(StandardCharsets.UTF_8),
                                    "def".getBytes(StandardCharsets.UTF_8)
                            ),
                            Arrays.asList(
                                    "abc".getBytes(StandardCharsets.UTF_8),
                                    "def".getBytes(StandardCharsets.UTF_8)
                            )
                    ),
                    "000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616263000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036465660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616263000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036465660000000000000000000000000000000000000000000000000000000000"
            );

            encodeParamTest("string[][2]",
                    Arrays.asList(
                            Arrays.asList("aaa", "bbb"),
                            Arrays.asList("aaa", "bbb")
                    ),
                    "00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000036161610000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000362626200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616161000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036262620000000000000000000000000000000000000000000000000000000000"
            );

            encodeParamTest("bytes[][2]",
                    Arrays.asList(
                            Arrays.asList(
                                    "abc".getBytes(StandardCharsets.UTF_8),
                                    "def".getBytes(StandardCharsets.UTF_8)
                            ),
                            Arrays.asList(
                                    "abc".getBytes(StandardCharsets.UTF_8),
                                    "def".getBytes(StandardCharsets.UTF_8)
                            )
                    ),
                    "00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000036162630000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000364656600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616263000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036465660000000000000000000000000000000000000000000000000000000000"
            );

            encodeParamTest("string[2][]",
                    Arrays.asList(
                            Arrays.asList("aaa", "bbb"),
                            Arrays.asList("aaa", "bbb")
                    ),
                    "0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616161000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036262620000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616161000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036262620000000000000000000000000000000000000000000000000000000000"
            );

            encodeParamTest("bytes[2][]",
                    Arrays.asList(
                            Arrays.asList(
                                    "abc".getBytes(StandardCharsets.UTF_8),
                                    "def".getBytes(StandardCharsets.UTF_8)
                            ),
                            Arrays.asList(
                                    "abc".getBytes(StandardCharsets.UTF_8),
                                    "def".getBytes(StandardCharsets.UTF_8)
                            )
                    ),
                    "0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616263000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036465660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616263000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036465660000000000000000000000000000000000000000000000000000000000"
            );

            encodeParamTest("string[][]",
                    Arrays.asList(
                            Arrays.asList("aaa", "bbb"),
                            Arrays.asList("aaa", "bbb")
                    ),
                    "000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000036161610000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000362626200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616161000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036262620000000000000000000000000000000000000000000000000000000000"
            );

            encodeParamTest("bytes[][]",
                    Arrays.asList(
                            Arrays.asList(
                                    "abc".getBytes(StandardCharsets.UTF_8),
                                    "def".getBytes(StandardCharsets.UTF_8)
                            ),
                            Arrays.asList(
                                    "abc".getBytes(StandardCharsets.UTF_8),
                                    "def".getBytes(StandardCharsets.UTF_8)
                            )
                    ),
                    "000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000036162630000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000364656600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616263000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036465660000000000000000000000000000000000000000000000000000000000"
            );
        }

        @Test
        public void encodeTupleType() throws ClassNotFoundException, InvocationTargetException, NoSuchMethodException, InstantiationException, IllegalAccessException {
            encodeParamTest(
                    "tuple(string,string)",
                    Arrays.asList("welcome to ethereum.", "welcome to ethereum."),
                    "0000000000000000000000000000000000000000000000000000000000000020" +
                            "0000000000000000000000000000000000000000000000000000000000000040" +
                            "0000000000000000000000000000000000000000000000000000000000000080" +
                            "0000000000000000000000000000000000000000000000000000000000000014" +
                            "77656c636f6d6520746f20657468657265756d2e000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000014" +
                            "77656c636f6d6520746f20657468657265756d2e000000000000000000000000");

            encodeParamTest(
                    "tuple(bytes,bytes)",
                    Arrays.asList("0x77656c636f6d6520746f20657468657265756d2e", "0x77656c636f6d6520746f20657468657265756d2e"),
                    "0000000000000000000000000000000000000000000000000000000000000020" +
                            "0000000000000000000000000000000000000000000000000000000000000040" +
                            "0000000000000000000000000000000000000000000000000000000000000080" +
                            "0000000000000000000000000000000000000000000000000000000000000014" +
                            "77656c636f6d6520746f20657468657265756d2e000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000014" +
                            "77656c636f6d6520746f20657468657265756d2e000000000000000000000000");

            encodeParamTest(
                    "tuple(bytes,bool,uint256)",
                    Arrays.asList("0x77656c636f6d6520746f20657468657265756d2e", true, 124515),
                    "0000000000000000000000000000000000000000000000000000000000000020" +
                            "0000000000000000000000000000000000000000000000000000000000000060" +
                            "0000000000000000000000000000000000000000000000000000000000000001" +
                            "000000000000000000000000000000000000000000000000000000000001e663" +
                            "0000000000000000000000000000000000000000000000000000000000000014" +
                            "77656c636f6d6520746f20657468657265756d2e000000000000000000000000"
            );

            encodeParamTest(
                    "tuple(string,tuple(bool,int256),address)",
                    Arrays.asList(
                            "hello",
                            Arrays.asList(true, -151),
                            "0x0175010374017501037401750103740175010374"
                    ),
                    "0000000000000000000000000000000000000000000000000000000000000020" +
                            "0000000000000000000000000000000000000000000000000000000000000080" +
                            "0000000000000000000000000000000000000000000000000000000000000001" +
                            "ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff69" +
                            "0000000000000000000000000175010374017501037401750103740175010374" +
                            "0000000000000000000000000000000000000000000000000000000000000005" +
                            "68656c6c6f000000000000000000000000000000000000000000000000000000"
            );

            encodeParamTest(
                    "tuple(tuple(bool,bool),tuple(address,address),tuple(string,string))",
                    Arrays.asList(
                            Arrays.asList(true, false),
                            Arrays.asList("0x81017589ab81017589ab81017589ab81017589ab", "0x81017589ab81017589ab81017589ab81017589ab"),
                            Arrays.asList("string One", "string Two")
                    ),
                    "0000000000000000000000000000000000000000000000000000000000000020" +
                            "0000000000000000000000000000000000000000000000000000000000000001" +
                            "0000000000000000000000000000000000000000000000000000000000000000" +
                            "00000000000000000000000081017589ab81017589ab81017589ab81017589ab" +
                            "00000000000000000000000081017589ab81017589ab81017589ab81017589ab" +
                            "00000000000000000000000000000000000000000000000000000000000000a0" +
                            "0000000000000000000000000000000000000000000000000000000000000040" +
                            "0000000000000000000000000000000000000000000000000000000000000080" +
                            "000000000000000000000000000000000000000000000000000000000000000a" +
                            "737472696e67204f6e6500000000000000000000000000000000000000000000" +
                            "000000000000000000000000000000000000000000000000000000000000000a" +
                            "737472696e672054776f00000000000000000000000000000000000000000000"
            );

            encodeParamTest(
                    "tuple(tuple(tuple(bool,bool),tuple(bytes,bytes),tuple(address,bool)),address)",
                    Arrays.asList(
                            Arrays.asList(
                                    Arrays.asList(false, false),
                                    Arrays.asList("0xab1394581edfa2ef9ca71", "0x15abe391df19aef19a4561"),
                                    Arrays.asList("0xec2270c849236333c86834728e783cd2f789088e", true)),
                            "0x81017589ab81017589ab81017589ab81017589ab"
                    ),
                    "0000000000000000000000000000000000000000000000000000000000000020" +
                            "0000000000000000000000000000000000000000000000000000000000000040" +
                            "00000000000000000000000081017589ab81017589ab81017589ab81017589ab" +
                            "0000000000000000000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000000" +
                            "00000000000000000000000000000000000000000000000000000000000000a0" +
                            "000000000000000000000000ec2270c849236333c86834728e783cd2f789088e" +
                            "0000000000000000000000000000000000000000000000000000000000000001" +
                            "0000000000000000000000000000000000000000000000000000000000000040" +
                            "0000000000000000000000000000000000000000000000000000000000000080" +
                            "000000000000000000000000000000000000000000000000000000000000000b" +
                            "0ab1394581edfa2ef9ca71000000000000000000000000000000000000000000" +
                            "000000000000000000000000000000000000000000000000000000000000000b" +
                            "15abe391df19aef19a4561000000000000000000000000000000000000000000"
            );

            encodeParamTest(
                    "tuple(bool,string,bool,tuple(address,address))",
                    Arrays.asList(
                            true,
                            "testing",
                            false,
                            Arrays.asList(
                                    "0x1981710abe1981710abe1981710abe1981710abe",
                                    "0x1981710abe1981710abe1981710abe1981710abe"
                            )
                    ),
                    "0000000000000000000000000000000000000000000000000000000000000020" +
                            "0000000000000000000000000000000000000000000000000000000000000001" +
                            "00000000000000000000000000000000000000000000000000000000000000a0" +
                            "0000000000000000000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000001981710abe1981710abe1981710abe1981710abe" +
                            "0000000000000000000000001981710abe1981710abe1981710abe1981710abe" +
                            "0000000000000000000000000000000000000000000000000000000000000007" +
                            "74657374696e6700000000000000000000000000000000000000000000000000"
            );

            encodeParamTest(
                    "tuple(address,address,tuple(string,tuple(int256,int256),string))",
                    Arrays.asList(
                            "0x1981710abe1981710abe1981710abe1981710abe",
                            "0x1981710abe1981710abe1981710abe1981710abe",
                            Arrays.asList(
                                    "structs are great",
                                    Arrays.asList(
                                            -1951, 194018
                                    ),
                                    "so many possibilities"
                            )
                    ),
                    "0000000000000000000000000000000000000000000000000000000000000020" +
                            "0000000000000000000000001981710abe1981710abe1981710abe1981710abe" +
                            "0000000000000000000000001981710abe1981710abe1981710abe1981710abe" +
                            "0000000000000000000000000000000000000000000000000000000000000060" +
                            "0000000000000000000000000000000000000000000000000000000000000080" +
                            "fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff861" +
                            "000000000000000000000000000000000000000000000000000000000002f5e2" +
                            "00000000000000000000000000000000000000000000000000000000000000c0" +
                            "0000000000000000000000000000000000000000000000000000000000000011" +
                            "7374727563747320617265206772656174000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000015" +
                            "736f206d616e7920706f73736962696c69746965730000000000000000000000"
            );

            encodeParamTest(
                    "tuple(bool,tuple(bytes32,int256,tuple(bytes24,bytes8)),tuple(bool,bool,bool),string)",
                    Arrays.asList(
                            true,
                            Arrays.asList(
                                    "0xabdef18710a18a18abdef18710a18a18abdef18710a18a18abdef18710a18a18",
                                    -18291849,
                                    Arrays.asList(
                                            "0xabdef18710a18a18abdef18710a18a18abdef18710a18a18",
                                            "0xabdef18710a18a18"
                                    )
                            ),
                            Arrays.asList(false, true, false),
                            "testing testing"
                    ),
                    "0000000000000000000000000000000000000000000000000000000000000020" +
                            "0000000000000000000000000000000000000000000000000000000000000001" +
                            "abdef18710a18a18abdef18710a18a18abdef18710a18a18abdef18710a18a18" +
                            "fffffffffffffffffffffffffffffffffffffffffffffffffffffffffee8e377" +
                            "abdef18710a18a18abdef18710a18a18abdef18710a18a180000000000000000" +
                            "abdef18710a18a18000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000001" +
                            "0000000000000000000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000120" +
                            "000000000000000000000000000000000000000000000000000000000000000f" +
                            "74657374696e672074657374696e670000000000000000000000000000000000"
            );

            encodeParamTest(
                    "tuple(string[3],bool)",
                    Arrays.asList(
                            Arrays.asList("aaa", "bbb", "ccc"),
                            false
                    ),
                    "000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000000361616100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003626262000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036363630000000000000000000000000000000000000000000000000000000000"
            );

            encodeParamTest(
                    "tuple(bool,string[3],bool)",
                    Arrays.asList(
                            true,
                            Arrays.asList("aaa", "bbb", "ccc"),
                            false
                    ),
                    "0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000000361616100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003626262000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036363630000000000000000000000000000000000000000000000000000000000"
            );

            encodeParamTest(
                    "tuple(bool,string[],bool)",
                    Arrays.asList(
                            true,
                            Arrays.asList("aaa", "bbb", "ccc"),
                            false
                    ),
                    "00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000000361616100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003626262000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036363630000000000000000000000000000000000000000000000000000000000"
            );

            encodeParamTest(
                    "tuple(bool,uint256[3],bool)",
                    Arrays.asList(
                            true,
                            Arrays.asList(111,222,333),
                            false
                    ),
                    "0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000006f00000000000000000000000000000000000000000000000000000000000000de000000000000000000000000000000000000000000000000000000000000014d0000000000000000000000000000000000000000000000000000000000000000"
            );

            encodeParamTest(
                    "tuple(bool,uint256[],bool)",
                    Arrays.asList(
                            true,
                            Arrays.asList(111,222,333),
                            false
                    ),
                    "00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006f00000000000000000000000000000000000000000000000000000000000000de000000000000000000000000000000000000000000000000000000000000014d"
            );

            encodeParamTest(
                    "tuple(string[3],bool)[]",
                    Arrays.asList(
                            Arrays.asList(
                                    Arrays.asList("aaa", "bbb", "ccc"),
                                    false
                            ),
                            Arrays.asList(
                                    Arrays.asList("ccc", "ddd", "fff"),
                                    false
                            )
                    ),

                    "00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000001a000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000036161610000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000362626200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003636363000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000000363636300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003646464000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036666660000000000000000000000000000000000000000000000000000000000"
            );

            encodeParamTest(
                    "tuple(string[3],bool)[2]",
                    Arrays.asList(
                            Arrays.asList(
                                    Arrays.asList("aaa", "bbb", "ccc"),
                                    false
                            ),
                            Arrays.asList(
                                    Arrays.asList("ccc", "ddd", "fff"),
                                    false
                            )
                    ),

                    "0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000001a000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000036161610000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000362626200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003636363000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000000363636300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003646464000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036666660000000000000000000000000000000000000000000000000000000000"
            );

            encodeParamTest(
                    "tuple(bool,uint256[3],bool)[]",
                    Arrays.asList(
                            Arrays.asList(
                                    true,
                                    Arrays.asList(111,222,333),
                                    false
                            ),
                            Arrays.asList(
                                    true,
                                    Arrays.asList(444,555,666),
                                    false
                            )
                    ),
                    "000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000006f00000000000000000000000000000000000000000000000000000000000000de000000000000000000000000000000000000000000000000000000000000014d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000001bc000000000000000000000000000000000000000000000000000000000000022b000000000000000000000000000000000000000000000000000000000000029a0000000000000000000000000000000000000000000000000000000000000000"
            );
        }

        @Test
        public void encodeParametersWithTuple() throws ClassNotFoundException, InvocationTargetException, NoSuchMethodException, InstantiationException, IllegalAccessException {
            encodeParametersTest(
                    Arrays.asList(
                            "string",
                            "tuple(string,string)"
                    ),
                    Arrays.asList(
                            "what",
                            Arrays.asList(
                                    "what what",
                                    "what what"
                            )
                    ),
                    "0000000000000000000000000000000000000000000000000000000000000040" +
                            "0000000000000000000000000000000000000000000000000000000000000080" +
                            "0000000000000000000000000000000000000000000000000000000000000004" +
                            "7768617400000000000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000040" +
                            "0000000000000000000000000000000000000000000000000000000000000080" +
                            "0000000000000000000000000000000000000000000000000000000000000009" +
                            "7768617420776861740000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000009" +
                            "7768617420776861740000000000000000000000000000000000000000000000"
            );

            encodeParametersTest(
                    Arrays.asList(
                            "tuple(bytes32,bool)",
                            "tuple(bool,address)"
                    ),
                    Arrays.asList(
                            Arrays.asList(
                                    "0xabdef18710a18a18abdef18710a18a18abdef18710a18a18abdef18710a18a18",
                                    true
                            ),
                            Arrays.asList(
                                    true,
                                    "0x77656c636f6d6520746f20657468657265756d2e"
                            )
                    ),
                    "abdef18710a18a18abdef18710a18a18abdef18710a18a18abdef18710a18a18" +
                            "0000000000000000000000000000000000000000000000000000000000000001" +
                            "0000000000000000000000000000000000000000000000000000000000000001" +
                            "00000000000000000000000077656c636f6d6520746f20657468657265756d2e"
            );

            encodeParametersTest(
                    Arrays.asList(
                            "tuple(address,uint256)",
                            "tuple(uint256,bool)",
                            "tuple(bytes32,bytes32)"
                    ),
                    Arrays.asList(
                            Arrays.asList(
                                    "0x77656c636f6d6520746f20657468657265756d2e",
                                    148
                            ),
                            Arrays.asList(
                                    5910,
                                    true
                            ),
                            Arrays.asList(
                                    "0xabdef18710a18a18abdef18710a18a18abdef18710a18a18abdef18710a18a18",
                                    "0xabdef18710a18a18abdef18710a18a18abdef18710a18a18abdef18710a18a18"
                            )
                    ),
                    "00000000000000000000000077656c636f6d6520746f20657468657265756d2e" +
                            "0000000000000000000000000000000000000000000000000000000000000094" +
                            "0000000000000000000000000000000000000000000000000000000000001716" +
                            "0000000000000000000000000000000000000000000000000000000000000001" +
                            "abdef18710a18a18abdef18710a18a18abdef18710a18a18abdef18710a18a18" +
                            "abdef18710a18a18abdef18710a18a18abdef18710a18a18abdef18710a18a18"
            );

            encodeParametersTest(
                    Arrays.asList(
                            "tuple(tuple(address,address),tuple(bool,bool))",
                            "tuple(tuple(bool,bool),tuple(bytes,bytes),tuple(uint256,uint256))",
                            "address"
                    ),
                    Arrays.asList(
                            Arrays.asList(
                                    Arrays.asList(
                                            "0x77656c636f6d6520746f20657468657265756d2e",
                                            "0x77656c636f6d6520746f20657468657265756d2e"
                                    ),
                                    Arrays.asList(
                                            true,
                                            false
                                    )
                            ),
                            Arrays.asList(
                                    Arrays.asList(
                                            false,
                                            true
                                    ),
                                    Arrays.asList(
                                            "0xab1394581edfa2ef9ca71",
                                            "0x15abe391df19aef19a4561"
                                    ),
                                    Arrays.asList(
                                            182,
                                            1937
                                    )
                            ),
                            "0x77656c636f6d6520746f20657468657265756d2e"
                    ),
                    "00000000000000000000000077656c636f6d6520746f20657468657265756d2e" +
                            "00000000000000000000000077656c636f6d6520746f20657468657265756d2e" +
                            "0000000000000000000000000000000000000000000000000000000000000001" +
                            "0000000000000000000000000000000000000000000000000000000000000000" +
                            "00000000000000000000000000000000000000000000000000000000000000c0" +
                            "00000000000000000000000077656c636f6d6520746f20657468657265756d2e" +
                            "0000000000000000000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000001" +
                            "00000000000000000000000000000000000000000000000000000000000000a0" +
                            "00000000000000000000000000000000000000000000000000000000000000b6" +
                            "0000000000000000000000000000000000000000000000000000000000000791" +
                            "0000000000000000000000000000000000000000000000000000000000000040" +
                            "0000000000000000000000000000000000000000000000000000000000000080" +
                            "000000000000000000000000000000000000000000000000000000000000000b" +
                            "0ab1394581edfa2ef9ca71000000000000000000000000000000000000000000" +
                            "000000000000000000000000000000000000000000000000000000000000000b" +
                            "15abe391df19aef19a4561000000000000000000000000000000000000000000"
            );

            encodeParametersTest(
                    Arrays.asList(
                            "tuple(tuple(uint256,bool),tuple(uint256,tuple(bytes,bytes)))",
                            "bytes",
                            "tuple(bool,tuple(bytes,address),bytes)"
                    ),
                    Arrays.asList(
                            Arrays.asList(
                                    Arrays.asList(
                                            18320,
                                            true
                                    ),
                                    Arrays.asList(
                                            691,
                                            Arrays.asList(
                                                    "0xab1394581edfa2ef9ca71",
                                                    "0x15abe391df19aef19a4561"
                                            )
                                    )
                            ),
                            "0xab1394581edfa2ef9ca71",
                            Arrays.asList(
                                    false,
                                    Arrays.asList(
                                            "0xfe",
                                            "0x77656c636f6d6520746f20657468657265756d2e"
                                    ),
                                    "0xabdef18710a18a18abdef18710a18a18abdef18710a18a18abdef18710a18a18"
                            )
                    ),
                    "0000000000000000000000000000000000000000000000000000000000000060" +
                            "00000000000000000000000000000000000000000000000000000000000001c0" +
                            "0000000000000000000000000000000000000000000000000000000000000200" +
                            "0000000000000000000000000000000000000000000000000000000000004790" +
                            "0000000000000000000000000000000000000000000000000000000000000001" +
                            "0000000000000000000000000000000000000000000000000000000000000060" +
                            "00000000000000000000000000000000000000000000000000000000000002b3" +
                            "0000000000000000000000000000000000000000000000000000000000000040" +
                            "0000000000000000000000000000000000000000000000000000000000000040" +
                            "0000000000000000000000000000000000000000000000000000000000000080" +
                            "000000000000000000000000000000000000000000000000000000000000000b" +
                            "0ab1394581edfa2ef9ca71000000000000000000000000000000000000000000" +
                            "000000000000000000000000000000000000000000000000000000000000000b" +
                            "15abe391df19aef19a4561000000000000000000000000000000000000000000" +
                            "000000000000000000000000000000000000000000000000000000000000000b" +
                            "0ab1394581edfa2ef9ca71000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000060" +
                            "00000000000000000000000000000000000000000000000000000000000000e0" +
                            "0000000000000000000000000000000000000000000000000000000000000040" +
                            "00000000000000000000000077656c636f6d6520746f20657468657265756d2e" +
                            "0000000000000000000000000000000000000000000000000000000000000001" +
                            "fe00000000000000000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000020" +
                            "abdef18710a18a18abdef18710a18a18abdef18710a18a18abdef18710a18a18"
            );

            encodeParametersTest(
                    Arrays.asList(
                            "address",
                            "tuple(bool,tuple(address,address))",
                            "tuple(tuple(address,tuple(int256,int256)),bool)"
                    ),
                    Arrays.asList(
                            "0x77656c636f6d6520746f20657468657265756d2e",
                            Arrays.asList(
                                    true,
                                    Arrays.asList(
                                            "0x77656c636f6d6520746f20657468657265756d2e",
                                            "0x77656c636f6d6520746f20657468657265756d2e"
                                    )
                            ),
                            Arrays.asList(
                                    Arrays.asList(
                                            "0x77656c636f6d6520746f20657468657265756d2e",
                                            Arrays.asList(-12451, -12451018)
                                    ),
                                    false
                            )
                    ),
                    "00000000000000000000000077656c636f6d6520746f20657468657265756d2e" +
                            "0000000000000000000000000000000000000000000000000000000000000001" +
                            "00000000000000000000000077656c636f6d6520746f20657468657265756d2e" +
                            "00000000000000000000000077656c636f6d6520746f20657468657265756d2e" +
                            "00000000000000000000000077656c636f6d6520746f20657468657265756d2e" +
                            "ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffcf5d" +
                            "ffffffffffffffffffffffffffffffffffffffffffffffffffffffffff420336" +
                            "0000000000000000000000000000000000000000000000000000000000000000"
            );

            encodeParametersTest(
                    Arrays.asList(
                            "bytes",
                            "tuple(tuple(bool,bool,bool),tuple(bytes,bytes,bytes),tuple(bytes,bool,address),tuple(uint256,int256,address))",
                            "tuple(bytes,tuple(tuple(int256,bool),tuple(uint256,bytes)))"
                    ),
                    Arrays.asList(
                            "0xabef15",
                            Arrays.asList(
                                    Arrays.asList(true, false, true),
                                    Arrays.asList(
                                            "0xabef15",
                                            "0xcdef151",
                                            "0xabfe151"
                                    ),
                                    Arrays.asList(
                                            "0x15abe391df19aef19a4561",
                                            true,
                                            "0x77656c636f6d6520746f20657468657265756d2e"
                                    ),
                                    Arrays.asList(
                                            1840181,
                                            -819184919,
                                            "0x77656c636f6d6520746f20657468657265756d2e")
                            ),
                            Arrays.asList(
                                    "0x77656c636f6d6520746f20657468657265756d2e",
                                    Arrays.asList(
                                            Arrays.asList(
                                                    -18491,
                                                    false
                                            ),
                                            Arrays.asList(
                                                    1918491,
                                                    "0xabdcf151dae"
                                            )
                                    )
                            )
                    ),
                    "0000000000000000000000000000000000000000000000000000000000000060" +
                            "00000000000000000000000000000000000000000000000000000000000000a0" +
                            "0000000000000000000000000000000000000000000000000000000000000360" +
                            "0000000000000000000000000000000000000000000000000000000000000003" +
                            "abef150000000000000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000001" +
                            "0000000000000000000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000001" +
                            "0000000000000000000000000000000000000000000000000000000000000100" +
                            "0000000000000000000000000000000000000000000000000000000000000220" +
                            "00000000000000000000000000000000000000000000000000000000001c1435" +
                            "ffffffffffffffffffffffffffffffffffffffffffffffffffffffffcf2c3ae9" +
                            "00000000000000000000000077656c636f6d6520746f20657468657265756d2e" +
                            "0000000000000000000000000000000000000000000000000000000000000060" +
                            "00000000000000000000000000000000000000000000000000000000000000a0" +
                            "00000000000000000000000000000000000000000000000000000000000000e0" +
                            "0000000000000000000000000000000000000000000000000000000000000003" +
                            "abef150000000000000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000004" +
                            "0cdef15100000000000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000004" +
                            "0abfe15100000000000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000060" +
                            "0000000000000000000000000000000000000000000000000000000000000001" +
                            "00000000000000000000000077656c636f6d6520746f20657468657265756d2e" +
                            "000000000000000000000000000000000000000000000000000000000000000b" +
                            "15abe391df19aef19a4561000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000040" +
                            "0000000000000000000000000000000000000000000000000000000000000080" +
                            "0000000000000000000000000000000000000000000000000000000000000014" +
                            "77656c636f6d6520746f20657468657265756d2e000000000000000000000000" +
                            "ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffb7c5" +
                            "0000000000000000000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000060" +
                            "00000000000000000000000000000000000000000000000000000000001d461b" +
                            "0000000000000000000000000000000000000000000000000000000000000040" +
                            "0000000000000000000000000000000000000000000000000000000000000006" +
                            "0abdcf151dae0000000000000000000000000000000000000000000000000000"
            );

            encodeParametersTest(
                    Arrays.asList(
                            "tuple(bytes,tuple(address,address))",
                            "tuple(address,address,address,bytes,address)",
                            "tuple(address,tuple(address,tuple(address,bool)))"
                    ),
                    Arrays.asList(
                            Arrays.asList(
                                    "0xabef15",
                                    Arrays.asList(
                                            "0x77656c636f6d6520746f20657468657265756d2e",
                                            "0x77656c636f6d6520746f20657468657265756d2e"
                                    )
                            ),
                            Arrays.asList(
                                    "0x77656c636f6d6520746f20657468657265756d2e",
                                    "0x77656c636f6d6520746f20657468657265756d2e",
                                    "0x77656c636f6d6520746f20657468657265756d2e",
                                    "0xabef15",
                                    "0x77656c636f6d6520746f20657468657265756d2e"
                            ),
                            Arrays.asList(
                                    "0x81017589ab81017589ab81017589ab81017589ab",
                                    Arrays.asList(
                                            "0x77656c636f6d6520746f20657468657265756d2e",
                                            Arrays.asList(
                                                    "0x81017589ab81017589ab81017589ab81017589ab",
                                                    false
                                            )
                                    )
                            )
                    ),
                    "00000000000000000000000000000000000000000000000000000000000000c0" +
                            "0000000000000000000000000000000000000000000000000000000000000160" +
                            "00000000000000000000000081017589ab81017589ab81017589ab81017589ab" +
                            "00000000000000000000000077656c636f6d6520746f20657468657265756d2e" +
                            "00000000000000000000000081017589ab81017589ab81017589ab81017589ab" +
                            "0000000000000000000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000060" +
                            "00000000000000000000000077656c636f6d6520746f20657468657265756d2e" +
                            "00000000000000000000000077656c636f6d6520746f20657468657265756d2e" +
                            "0000000000000000000000000000000000000000000000000000000000000003" +
                            "abef150000000000000000000000000000000000000000000000000000000000" +
                            "00000000000000000000000077656c636f6d6520746f20657468657265756d2e" +
                            "00000000000000000000000077656c636f6d6520746f20657468657265756d2e" +
                            "00000000000000000000000077656c636f6d6520746f20657468657265756d2e" +
                            "00000000000000000000000000000000000000000000000000000000000000a0" +
                            "00000000000000000000000077656c636f6d6520746f20657468657265756d2e" +
                            "0000000000000000000000000000000000000000000000000000000000000003" +
                            "abef150000000000000000000000000000000000000000000000000000000000"
            );

            encodeParametersTest(
                    Arrays.asList(
                            "tuple(bytes,bytes)",
                            "bytes",
                            "tuple(tuple(bytes),tuple(bytes,bytes),tuple(bytes,bytes,bytes))"
                    ),
                    Arrays.asList(
                            Arrays.asList(
                                    "0xabef15",
                                    "0xa"),
                            "0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",
                            Arrays.asList(
                                    Arrays.asList("0xaf"),
                                    Arrays.asList("0xaf", "0xbc"),
                                    Arrays.asList("0xaf", "0xbc", "0xde")
                            )
                    ),
                    "0000000000000000000000000000000000000000000000000000000000000060" +
                            "0000000000000000000000000000000000000000000000000000000000000120" +
                            "0000000000000000000000000000000000000000000000000000000000000160" +
                            "0000000000000000000000000000000000000000000000000000000000000040" +
                            "0000000000000000000000000000000000000000000000000000000000000080" +
                            "0000000000000000000000000000000000000000000000000000000000000003" +
                            "abef150000000000000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000001" +
                            "0a00000000000000000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000020" +
                            "ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff" +
                            "0000000000000000000000000000000000000000000000000000000000000060" +
                            "00000000000000000000000000000000000000000000000000000000000000c0" +
                            "0000000000000000000000000000000000000000000000000000000000000180" +
                            "0000000000000000000000000000000000000000000000000000000000000020" +
                            "0000000000000000000000000000000000000000000000000000000000000001" +
                            "af00000000000000000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000040" +
                            "0000000000000000000000000000000000000000000000000000000000000080" +
                            "0000000000000000000000000000000000000000000000000000000000000001" +
                            "af00000000000000000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000001" +
                            "bc00000000000000000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000060" +
                            "00000000000000000000000000000000000000000000000000000000000000a0" +
                            "00000000000000000000000000000000000000000000000000000000000000e0" +
                            "0000000000000000000000000000000000000000000000000000000000000001" +
                            "af00000000000000000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000001" +
                            "bc00000000000000000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000001" +
                            "de00000000000000000000000000000000000000000000000000000000000000"
            );

            encodeParametersTest(
                    Arrays.asList(
                            "tuple(string,uint)[]"
                    ),
                    Arrays.asList(
                            Arrays.asList(
                                    Arrays.asList(
                                            "item1", 2
                                    ),
                                    Arrays.asList(
                                            "item2", 3
                                    )
                            )
                    ),
                    "00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000056974656d310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000056974656d32000000000000000000000000000000000000000000000000000000"
            );

            encodeParametersTest(
                    Arrays.asList(
                            "tuple(string,uint16)[]"
                    ),
                    Arrays.asList(
                            Arrays.asList(
                                    Arrays.asList(
                                            "item1", 2
                                    ),
                                    Arrays.asList(
                                            "item2", 3
                                    )
                            )
                    ),
                    "00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000056974656d310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000056974656d32000000000000000000000000000000000000000000000000000000"
            );
        }

        @Test
        public void encodeParametersArrayType() throws ClassNotFoundException, InvocationTargetException, NoSuchMethodException, InstantiationException, IllegalAccessException {
            //fixed_static, fixed_static
            encodeParametersTest(
                    Arrays.asList("bool[2]", "uint256[2]"),
                    Arrays.asList(
                            Arrays.asList(true, false),
                            Arrays.asList(111, 222)
                    ),
                    "00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006f00000000000000000000000000000000000000000000000000000000000000de"
            );

            //var_dynamic, var_dynamic
            encodeParametersTest(
                    Arrays.asList("bytes[][]", "string[][]"),
                    Arrays.asList(
                            Arrays.asList(
                                    Arrays.asList(
                                            "abc".getBytes(StandardCharsets.UTF_8),
                                            "def".getBytes(StandardCharsets.UTF_8)
                                    ),
                                    Arrays.asList(
                                            "abc".getBytes(StandardCharsets.UTF_8),
                                            "def".getBytes(StandardCharsets.UTF_8)
                                    )
                            ),
                            Arrays.asList(
                                    Arrays.asList("aaa", "bbb"),
                                    Arrays.asList("ccc", "ddd")
                            )
                    ),
                    "000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000002600000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000001200000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616263000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036465660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000361626300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003646566000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000036161610000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000362626200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003636363000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036464640000000000000000000000000000000000000000000000000000000000"
            );

            //fixed_static, fixed_dynamic, fixed_static, var_dynamic
            encodeParametersTest(
                    Arrays.asList(
                            "bool[2]", "string[2]","uint256[2]", "string[]"
                    ),
                    Arrays.asList(
                            Arrays.asList(true, false),
                            Arrays.asList("aaa", "bbb"),
                            Arrays.asList(111, 222),
                            Arrays.asList("ccc", "ddd")
                    ),
                    "0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000006f00000000000000000000000000000000000000000000000000000000000000de00000000000000000000000000000000000000000000000000000000000001800000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000036161610000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000362626200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003636363000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036464640000000000000000000000000000000000000000000000000000000000"
            );

            //var_static, fixed_dynamic, var_static, fixed_dynamic
            encodeParametersTest(
                    Arrays.asList(
                            "bool[]", "string[2]","uint256[]", "string[2]"
                    ),
                    Arrays.asList(
                            Arrays.asList(true, false),
                            Arrays.asList("aaa", "bbb"),
                            Arrays.asList(111, 222),
                            Arrays.asList("ccc", "ddd")
                    ),
                    "000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000001a000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000036161610000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000362626200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000006f00000000000000000000000000000000000000000000000000000000000000de000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003636363000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036464640000000000000000000000000000000000000000000000000000000000"
            );
        }
    }

    public static class decodeParameter {
        public void decodeParameterTest(String type, Object expectedValue, String value) throws ClassNotFoundException, NoSuchMethodException, InstantiationException, IllegalAccessException, InvocationTargetException {
            assertEquals(TypeDecoder.instantiateType(type, expectedValue), caver.abi.decodeParameter(type, value));
        }

        public void decodeParametersTest(List<String> type, List<Object> expectedValue, String value) throws ClassNotFoundException, NoSuchMethodException, InstantiationException, IllegalAccessException, InvocationTargetException {
            List<Type> resultList = caver.abi.decodeParameters(type, value);
            for(int i=0; i<type.size(); i++) {
                assertEquals(TypeDecoder.instantiateType(type.get(i), expectedValue.get(i)), resultList.get(i));
            }
        }


        @Test
        public void decodeBoolType() throws ClassNotFoundException {
            assertEquals(
                    caver.abi.decodeParameter("bool", "0000000000000000000000000000000000000000000000000000000000000000"),
                    (new Bool(false)));
            assertEquals(
                    caver.abi.decodeParameter("bool", "0000000000000000000000000000000000000000000000000000000000000001"),
                    (new Bool(true)));
        }

        @Test
        public void decodeUintType() throws ClassNotFoundException {
            Uint uint = new Uint256(BigInteger.valueOf(255));
            assertEquals(
                    caver.abi.decodeParameter("uint256", "00000000000000000000000000000000000000000000000000000000000000ff"),
                    uint);


            Uint uint2 = new Uint256(BigInteger.valueOf(65535));
            assertEquals(
                    caver.abi.decodeParameter("uint256", "000000000000000000000000000000000000000000000000000000000000ffff"),
                    uint2
            );

            Uint uint3 = new Uint256(BigInteger.valueOf(65536));
            assertEquals(
                    caver.abi.decodeParameter("uint256", "0000000000000000000000000000000000000000000000000000000000010000"),
                    uint3);

            Uint uint4 = new Uint256(new BigInteger("4722366482869645213695"));
            assertEquals(
                    caver.abi.decodeParameter("uint256", "0000000000000000000000000000000000000000000000ffffffffffffffffff"),
                    uint4);

            Uint uint5 = new Uint256(BigInteger.ZERO);
            assertEquals(
                    caver.abi.decodeParameter("uint256", "0000000000000000000000000000000000000000000000000000000000000000"),
                    uint5
                    );
        }

        @Test
        public void decodeIntType() throws ClassNotFoundException {
            Int int1 = new Int256(BigInteger.ZERO);
            assertEquals(
                    caver.abi.decodeParameter("int256", "0000000000000000000000000000000000000000000000000000000000000000"),
                    int1);

            Int int2 = new Int256(BigInteger.valueOf(127));
            assertEquals(
                    caver.abi.decodeParameter("int256", "000000000000000000000000000000000000000000000000000000000000007f"),
                    int2);

            Int int3 = new Int256(BigInteger.valueOf(32767));
            assertEquals(
                    caver.abi.decodeParameter("int256", "0000000000000000000000000000000000000000000000000000000000007fff"),
                    int3);

            Int int4 = new Int256(BigInteger.valueOf(2147483647));
            assertEquals(
                    caver.abi.decodeParameter("int256","000000000000000000000000000000000000000000000000000000007fffffff"),
                    int4);
        }

        @Test
        public void decodeAddressType() throws ClassNotFoundException {
            Address address = new Address("0xbe5422d15f39373eb0a97ff8c10fbd0e40e29338");
            assertEquals(
                    caver.abi.decodeParameter("address","000000000000000000000000be5422d15f39373eb0a97ff8c10fbd0e40e29338"),
                    address);
        }

        @Test
        public void decodeUtf8StringType() throws ClassNotFoundException {
            Utf8String string = new Utf8String("Hello, world!");
            assertEquals(
                    caver.abi.decodeParameter("string",
                            "0000000000000000000000000000000000000000000000000000000000000020"
                            + "000000000000000000000000000000000000000000000000000000000000000d"
                            + "48656c6c6f2c20776f726c642100000000000000000000000000000000000000"),
                    string);
        }

        @Test
        public void decodeStaticBytesType() throws ClassNotFoundException {
            Bytes staticBytes = new Bytes6(new byte[] {0, 1, 2, 3, 4, 5});
            assertEquals(
                    caver.abi.decodeParameter("bytes6", "0001020304050000000000000000000000000000000000000000000000000000"),
                    staticBytes);

            Bytes empty = new Bytes1(new byte[] {0});
            assertEquals(
                    caver.abi.decodeParameter("bytes1", "0000000000000000000000000000000000000000000000000000000000000000"),
                    empty);

            Bytes ones = new Bytes1(new byte[] {127});
            assertEquals(
                    caver.abi.decodeParameter("bytes1", "7f00000000000000000000000000000000000000000000000000000000000000"),
                    ones);

            Bytes dave = new Bytes4("dave".getBytes());
            assertEquals(
                    caver.abi.decodeParameter("bytes4", "6461766500000000000000000000000000000000000000000000000000000000"),
                    dave);
        }

        @Test
        public void decodeDynamicBytesType() throws ClassNotFoundException {
            DynamicBytes dynamicBytes = new DynamicBytes(new byte[] {0, 1, 2, 3, 4, 5});
            assertEquals(
                    caver.abi.decodeParameter("bytes",
                            "0000000000000000000000000000000000000000000000000000000000000020"
                                    + "0000000000000000000000000000000000000000000000000000000000000006"
                                    + "0001020304050000000000000000000000000000000000000000000000000000"),
                    dynamicBytes);

            DynamicBytes empty = new DynamicBytes(new byte[] {0});
            assertEquals(
                    caver.abi.decodeParameter("bytes",
                            "0000000000000000000000000000000000000000000000000000000000000020"
                            +"0000000000000000000000000000000000000000000000000000000000000001"
                            + "0000000000000000000000000000000000000000000000000000000000000000"),
                    empty);

            DynamicBytes dave = new DynamicBytes("dave".getBytes());
            assertEquals(
                    caver.abi.decodeParameter("bytes",
                            "0000000000000000000000000000000000000000000000000000000000000020"
                            +"0000000000000000000000000000000000000000000000000000000000000004"
                            + "6461766500000000000000000000000000000000000000000000000000000000"),
                    dave);

            DynamicBytes loremIpsum =
                    new DynamicBytes(
                            ("Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod "
                                    + "tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim "
                                    + "veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex "
                                    + "ea commodo consequat. Duis aute irure dolor in reprehenderit in "
                                    + "voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur "
                                    + "sint occaecat cupidatat non proident, sunt in culpa qui officia "
                                    + "deserunt mollit anim id est laborum.")
                                    .getBytes());
            assertEquals(
                    caver.abi.decodeParameter("bytes",
                            "0000000000000000000000000000000000000000000000000000000000000020"
                            +"00000000000000000000000000000000000000000000000000000000000001bd"
                            + "4c6f72656d20697073756d20646f6c6f722073697420616d65742c20636f6e73"
                            + "656374657475722061646970697363696e6720656c69742c2073656420646f20"
                            + "656975736d6f642074656d706f7220696e6369646964756e74207574206c6162"
                            + "6f726520657420646f6c6f7265206d61676e6120616c697175612e2055742065"
                            + "6e696d206164206d696e696d2076656e69616d2c2071756973206e6f73747275"
                            + "6420657865726369746174696f6e20756c6c616d636f206c61626f726973206e"
                            + "69736920757420616c697175697020657820656120636f6d6d6f646f20636f6e"
                            + "7365717561742e2044756973206175746520697275726520646f6c6f7220696e"
                            + "20726570726568656e646572697420696e20766f6c7570746174652076656c69"
                            + "7420657373652063696c6c756d20646f6c6f726520657520667567696174206e"
                            + "756c6c612070617269617475722e204578636570746575722073696e74206f63"
                            + "63616563617420637570696461746174206e6f6e2070726f6964656e742c2073"
                            + "756e7420696e2063756c706120717569206f666669636961206465736572756e"
                            + "74206d6f6c6c697420616e696d20696420657374206c61626f72756d2e000000"),
                    loremIpsum);
        }

        @Test
        public void decodeDynamicArrayTest() throws ClassNotFoundException {
            DynamicArray<Uint256> array =
                    new DynamicArray<>(
                            Uint256.class,
                            new Uint256(BigInteger.ONE),
                            new Uint256(BigInteger.valueOf(2)),
                            new Uint256(BigInteger.valueOf(3)));

            assertEquals(
                    caver.abi.decodeParameter("uint256[]",
                            "0000000000000000000000000000000000000000000000000000000000000020"
                            + "0000000000000000000000000000000000000000000000000000000000000003"
                            + "0000000000000000000000000000000000000000000000000000000000000001"
                            + "0000000000000000000000000000000000000000000000000000000000000002"
                            + "0000000000000000000000000000000000000000000000000000000000000003"),
                    array);
        }

        @Test
        public void decodeStaticArrayTest() throws ClassCastException, ClassNotFoundException, NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException {
            StaticArray2 expected = new StaticArray2(Uint256.class, Arrays.asList(BigInteger.TEN, BigInteger.valueOf(Long.MAX_VALUE)));
            StaticArray2 actual = (StaticArray2)caver.abi.decodeParameter("uint256[2]",
                    "000000000000000000000000000000000000000000000000000000000000000a"
                            + "0000000000000000000000000000000000000000000000007fffffffffffffff");

            assertEquals(expected.getValue().get(0), ((Uint256)actual.getValue().get(0)).getValue());
            assertEquals(expected.getValue().get(1), ((Uint256)actual.getValue().get(1)).getValue());
        }


        @Test
        public void decodeArrayStaticType() throws ClassNotFoundException, NoSuchMethodException, InstantiationException, IllegalAccessException, InvocationTargetException {
            //primitive type
            decodeParameterTest("uint256[3]",
                Arrays.asList(1,2,3),
                "000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003"
            );

            //primitive type
            decodeParameterTest("bool[2]",
                Arrays.asList(
                    true, false
                ),
                "00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000"
            );

            decodeParameterTest("bytes3[2]",
                Arrays.asList(
                    "abc".getBytes(StandardCharsets.UTF_8),
                    "def".getBytes(StandardCharsets.UTF_8)
                ),"61626300000000000000000000000000000000000000000000000000000000006465660000000000000000000000000000000000000000000000000000000000"

            );

            decodeParameterTest("uint256[]",
                Arrays.asList(1,2,3),
                "00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003"
            );

            decodeParameterTest("bool[]",
                Arrays.asList(
                    true, false
                ),
                "0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000"
            );

            decodeParameterTest("bytes3[]",
                Arrays.asList(
                    "abc".getBytes(StandardCharsets.UTF_8),
                    "def".getBytes(StandardCharsets.UTF_8)
                ),"0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000261626300000000000000000000000000000000000000000000000000000000006465660000000000000000000000000000000000000000000000000000000000"

            );

            decodeParameterTest("uint256[3][2]",
                Arrays.asList(
                    Arrays.asList(1,2,3),
                    Arrays.asList(4,5,6)
                ),
                "000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000050000000000000000000000000000000000000000000000000000000000000006"
            );

            decodeParameterTest("bool[2][2]",
                Arrays.asList(
                    Arrays.asList(
                        true, false
                    ),
                    Arrays.asList(
                        true, false
                    )
                ),
                "0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000"
            );

            decodeParameterTest("bytes3[2][1]",
                Arrays.asList(Arrays.asList(
                    "abc".getBytes(StandardCharsets.UTF_8),
                    "def".getBytes(StandardCharsets.UTF_8)
                )),
                "61626300000000000000000000000000000000000000000000000000000000006465660000000000000000000000000000000000000000000000000000000000"
            );

            decodeParameterTest("uint256[][2]",
                Arrays.asList(
                    Arrays.asList(1,2,3),
                    Arrays.asList(1,2,3)
                ),
                "0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003"
            );

            decodeParameterTest("bool[][2]",
                Arrays.asList(
                    Arrays.asList(
                        true, false
                    ),
                    Arrays.asList(
                        true, false
                    )
                ),
                "0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000"
            );

            decodeParameterTest("bytes3[][1]",
                Arrays.asList(Arrays.asList(
                    "abc".getBytes(StandardCharsets.UTF_8),
                    "def".getBytes(StandardCharsets.UTF_8)
                )),
                "00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000261626300000000000000000000000000000000000000000000000000000000006465660000000000000000000000000000000000000000000000000000000000"

            );

            decodeParameterTest("uint256[3][]",
                Arrays.asList(
                    Arrays.asList(1,2,3),
                    Arrays.asList(1,2,3)
                ),
                "00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003"
            );

            decodeParameterTest("bool[2][]",
                Arrays.asList(
                    Arrays.asList(
                        true, false
                    )
                ),
                "0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000"
            );

            decodeParameterTest("bytes3[2][]",
                Arrays.asList(Arrays.asList(
                    "abc".getBytes(StandardCharsets.UTF_8),
                    "def".getBytes(StandardCharsets.UTF_8)
                )),
                "0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000161626300000000000000000000000000000000000000000000000000000000006465660000000000000000000000000000000000000000000000000000000000"
            );

            decodeParameterTest("uint256[][]",
                Arrays.asList(
                    Arrays.asList(1,2,3),
                    Arrays.asList(1,2,3)
                ),
                "00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003"
            );

            decodeParameterTest("bool[][]",
                Arrays.asList(
                    Arrays.asList(
                        true, false
                    ),
                    Arrays.asList(
                        true, false
                    )
                ),
                "00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000"
            );

            decodeParameterTest("bytes3[][]",
                Arrays.asList(Arrays.asList(
                    "abc".getBytes(StandardCharsets.UTF_8),
                    "def".getBytes(StandardCharsets.UTF_8)
                )),
                "000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000261626300000000000000000000000000000000000000000000000000000000006465660000000000000000000000000000000000000000000000000000000000"
            );
        }

        @org.junit.Test
        public void decodeArrayDynamicType() throws ClassNotFoundException, NoSuchMethodException, InstantiationException, IllegalAccessException, InvocationTargetException {
            //primitive type
            decodeParameterTest("string[2]",
                Arrays.asList("aaa", "bbb"),
                "0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616161000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036262620000000000000000000000000000000000000000000000000000000000"
            );

            //primitive type
            decodeParameterTest("bytes[2]",
                Arrays.asList(
                    "abc".getBytes(StandardCharsets.UTF_8),
                    "def".getBytes(StandardCharsets.UTF_8)
                ),
                "0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616263000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036465660000000000000000000000000000000000000000000000000000000000"
            );

            decodeParameterTest("string[]",
                Arrays.asList("aaa", "bbb"),
                "00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616161000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036262620000000000000000000000000000000000000000000000000000000000"
            );

            decodeParameterTest("bytes[]",
                Arrays.asList(
                    "abc".getBytes(StandardCharsets.UTF_8),
                    "def".getBytes(StandardCharsets.UTF_8)
                ),
                "00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616263000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036465660000000000000000000000000000000000000000000000000000000000"
            );

            decodeParameterTest("string[2][2]",
                Arrays.asList(
                    Arrays.asList("aaa", "bbb"),
                    Arrays.asList("ccc", "ddd")
                ),
                "0000000000000000000000000000000000000000000000000000000000000020" +
                    "0000000000000000000000000000000000000000000000000000000000000040" +
                    "0000000000000000000000000000000000000000000000000000000000000100" +
                    "0000000000000000000000000000000000000000000000000000000000000040" +
                    "0000000000000000000000000000000000000000000000000000000000000080" +
                    "0000000000000000000000000000000000000000000000000000000000000003" +
                    "6161610000000000000000000000000000000000000000000000000000000000" +
                    "0000000000000000000000000000000000000000000000000000000000000003" +
                    "6262620000000000000000000000000000000000000000000000000000000000" +
                    "0000000000000000000000000000000000000000000000000000000000000040" +
                    "0000000000000000000000000000000000000000000000000000000000000080" +
                    "0000000000000000000000000000000000000000000000000000000000000003" +
                    "6363630000000000000000000000000000000000000000000000000000000000" +
                    "0000000000000000000000000000000000000000000000000000000000000003" +
                    "6464640000000000000000000000000000000000000000000000000000000000"
            );

            decodeParameterTest("bytes[2][2]",
                Arrays.asList(
                    Arrays.asList(
                        "abc".getBytes(StandardCharsets.UTF_8),
                        "def".getBytes(StandardCharsets.UTF_8)
                    ),
                    Arrays.asList(
                        "abc".getBytes(StandardCharsets.UTF_8),
                        "def".getBytes(StandardCharsets.UTF_8)
                    )
                ),
                "000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616263000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036465660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616263000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036465660000000000000000000000000000000000000000000000000000000000"
            );

            decodeParameterTest("string[][2]",
                Arrays.asList(
                    Arrays.asList("aaa", "bbb"),
                    Arrays.asList("aaa", "bbb")
                ),
                "00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000036161610000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000362626200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616161000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036262620000000000000000000000000000000000000000000000000000000000"
            );

            decodeParameterTest("bytes[][2]",
                Arrays.asList(
                    Arrays.asList(
                        "abc".getBytes(StandardCharsets.UTF_8),
                        "def".getBytes(StandardCharsets.UTF_8)
                    ),
                    Arrays.asList(
                        "abc".getBytes(StandardCharsets.UTF_8),
                        "def".getBytes(StandardCharsets.UTF_8)
                    )
                ),
                "00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000036162630000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000364656600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616263000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036465660000000000000000000000000000000000000000000000000000000000"
            );

            decodeParameterTest("string[2][]",
                Arrays.asList(
                    Arrays.asList("aaa", "bbb"),
                    Arrays.asList("aaa", "bbb")
                ),
                "0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616161000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036262620000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616161000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036262620000000000000000000000000000000000000000000000000000000000"
            );

            decodeParameterTest("bytes[2][]",
                Arrays.asList(
                    Arrays.asList(
                        "abc".getBytes(StandardCharsets.UTF_8),
                        "def".getBytes(StandardCharsets.UTF_8)
                    ),
                    Arrays.asList(
                        "abc".getBytes(StandardCharsets.UTF_8),
                        "def".getBytes(StandardCharsets.UTF_8)
                    )
                ),
                "0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616263000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036465660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616263000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036465660000000000000000000000000000000000000000000000000000000000"
            );

            decodeParameterTest("string[][]",
                Arrays.asList(
                    Arrays.asList("aaa", "bbb"),
                    Arrays.asList("aaa", "bbb")
                ),
                "000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000036161610000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000362626200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616161000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036262620000000000000000000000000000000000000000000000000000000000"
            );

            decodeParameterTest("bytes[][]",
                Arrays.asList(
                    Arrays.asList(
                        "abc".getBytes(StandardCharsets.UTF_8),
                        "def".getBytes(StandardCharsets.UTF_8)
                    ),
                    Arrays.asList(
                        "abc".getBytes(StandardCharsets.UTF_8),
                        "def".getBytes(StandardCharsets.UTF_8)
                    )
                ),
                "000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000036162630000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000364656600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616263000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036465660000000000000000000000000000000000000000000000000000000000"
            );
        }

        @Test
        public void decodeTupleType() throws ClassNotFoundException, InvocationTargetException, NoSuchMethodException, InstantiationException, IllegalAccessException {
            decodeParameterTest(
                    "tuple(address)",
                    Arrays.asList("0xbBF289D846208c16EDc8474705C748aff07732dB"),
                    "000000000000000000000000bbf289d846208c16edc8474705c748aff07732db"
            );

            decodeParameterTest(
                    "tuple(address,address)",
                    Arrays.asList("0xbBF289D846208c16EDc8474705C748aff07732dB", "0xbBF289D846208c16EDc8474705C748aff07732dB"),
                    "" +
                            "000000000000000000000000bbf289d846208c16edc8474705c748aff07732db" +
                            "000000000000000000000000bbf289d846208c16edc8474705c748aff07732db"
            );

            decodeParameterTest(
                    "tuple(uint256,uint256)",
                    Arrays.asList(5,5),
                    "" +
                            "0000000000000000000000000000000000000000000000000000000000000005" +
                            "0000000000000000000000000000000000000000000000000000000000000005"
            );

            decodeParameterTest(
                    "tuple(string,string)",
                    Arrays.asList("hello", "world"),
                    "" +
                            "0000000000000000000000000000000000000000000000000000000000000020" +
                            "0000000000000000000000000000000000000000000000000000000000000040" +
                            "0000000000000000000000000000000000000000000000000000000000000080" +
                            "0000000000000000000000000000000000000000000000000000000000000005" +
                            "68656c6c6f000000000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000005" +
                            "776f726c64000000000000000000000000000000000000000000000000000000"
            );

            decodeParameterTest(
                    "tuple(bytes,bytes)",
                    Arrays.asList("0x01fe517acd15ff", "0xabcdef12345678"),
                    "" +
                            "0000000000000000000000000000000000000000000000000000000000000020" +
                            "0000000000000000000000000000000000000000000000000000000000000040" +
                            "0000000000000000000000000000000000000000000000000000000000000080" +
                            "0000000000000000000000000000000000000000000000000000000000000007" +
                            "01fe517acd15ff00000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000007" +
                            "abcdef1234567800000000000000000000000000000000000000000000000000"
            );

            decodeParameterTest(
                    "tuple(bool,bool)",
                    Arrays.asList(false, true),
                    "" +
                            "0000000000000000000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000001"
            );

            decodeParameterTest(
                    "tuple(uint256,string,bytes)",
                    Arrays.asList(4, "what what", "0xabcdef12345678"),
                    "" +
                            "0000000000000000000000000000000000000000000000000000000000000020" +
                            "0000000000000000000000000000000000000000000000000000000000000004" +
                            "0000000000000000000000000000000000000000000000000000000000000060" +
                            "00000000000000000000000000000000000000000000000000000000000000a0" +
                            "0000000000000000000000000000000000000000000000000000000000000009" +
                            "7768617420776861740000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000007" +
                            "abcdef1234567800000000000000000000000000000000000000000000000000"
            );

            decodeParameterTest(
                    "tuple(uint128,string,bytes)",
                    Arrays.asList(666, "encode your kids", "0x656e636f646520796f75722077696665"),
                    "" +
                            "0000000000000000000000000000000000000000000000000000000000000020" +
                            "000000000000000000000000000000000000000000000000000000000000029a" +
                            "0000000000000000000000000000000000000000000000000000000000000060" +
                            "00000000000000000000000000000000000000000000000000000000000000a0" +
                            "0000000000000000000000000000000000000000000000000000000000000010" +
                            "656e636f646520796f7572206b69647300000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000010" +
                            "656e636f646520796f7572207769666500000000000000000000000000000000"
            );

            decodeParameterTest(
                    "tuple(string,bytes32,uint256,bool)",
                    Arrays.asList("foo bar", "0xaabbccddeeff0000000000000000000000000000000000000000000000000000", 321, true),
                    "" +
                            "0000000000000000000000000000000000000000000000000000000000000020" +
                            "0000000000000000000000000000000000000000000000000000000000000080" +
                            "aabbccddeeff0000000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000141" +
                            "0000000000000000000000000000000000000000000000000000000000000001" +
                            "0000000000000000000000000000000000000000000000000000000000000007" +
                            "666f6f2062617200000000000000000000000000000000000000000000000000"
            );

            decodeParameterTest(
                    "tuple(uint8,uint8,uint8,uint8,string,address,bool)",
                    Arrays.asList(1, 2, 3, 4, "five", "0x0000000000000000000000000000000000000006", true),
                    "" +
                            "0000000000000000000000000000000000000000000000000000000000000020" +
                            "0000000000000000000000000000000000000000000000000000000000000001" +
                            "0000000000000000000000000000000000000000000000000000000000000002" +
                            "0000000000000000000000000000000000000000000000000000000000000003" +
                            "0000000000000000000000000000000000000000000000000000000000000004" +
                            "00000000000000000000000000000000000000000000000000000000000000e0" +
                            "0000000000000000000000000000000000000000000000000000000000000006" +
                            "0000000000000000000000000000000000000000000000000000000000000001" +
                            "0000000000000000000000000000000000000000000000000000000000000004" +
                            "6669766500000000000000000000000000000000000000000000000000000000"
            );

            decodeParameterTest(
                    "tuple(tuple(address,address),tuple(uint256,uint256))",
                    Arrays.asList(Arrays.asList("0x1234567890123456789012345678901234567890", "0x1234567890123456789012345678901234567890"), Arrays.asList(5,6)),
                    "" +
                            "0000000000000000000000001234567890123456789012345678901234567890" +
                            "0000000000000000000000001234567890123456789012345678901234567890" +
                            "0000000000000000000000000000000000000000000000000000000000000005" +
                            "0000000000000000000000000000000000000000000000000000000000000006"
            );

            decodeParameterTest(
                    "tuple(tuple(address,address),tuple(uint256,uint256),tuple(string,string))",
                    Arrays.asList(
                            Arrays.asList("0x1234567890123456789012345678901234567890", "0x1234567890123456789012345678901234567890"),
                            Arrays.asList(5,6),
                            Arrays.asList("a string", "another string")
                    ),
                    "" +
                            "0000000000000000000000000000000000000000000000000000000000000020" +
                            "0000000000000000000000001234567890123456789012345678901234567890" +
                            "0000000000000000000000001234567890123456789012345678901234567890" +
                            "0000000000000000000000000000000000000000000000000000000000000005" +
                            "0000000000000000000000000000000000000000000000000000000000000006" +
                            "00000000000000000000000000000000000000000000000000000000000000a0" +
                            "0000000000000000000000000000000000000000000000000000000000000040" +
                            "0000000000000000000000000000000000000000000000000000000000000080" +
                            "0000000000000000000000000000000000000000000000000000000000000008" +
                            "6120737472696e67000000000000000000000000000000000000000000000000" +
                            "000000000000000000000000000000000000000000000000000000000000000e" +
                            "616e6f7468657220737472696e67000000000000000000000000000000000000"
            );

            decodeParameterTest(
                    "tuple(string,uint)[]",
                    Arrays.asList(
                            Arrays.asList(
                                    "item1", 2
                            ),
                            Arrays.asList(
                                    "item2", 3
                            )
                    ),

                    "00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000056974656d310000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000056974656d32000000000000000000000000000000000000000000000000000000"
            );

            decodeParameterTest(
                    "tuple(string[3],bool)",
                    Arrays.asList(
                            Arrays.asList("aaa", "bbb", "ccc"),
                            false
                    ),
                    "000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000000361616100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003626262000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036363630000000000000000000000000000000000000000000000000000000000"
            );

            decodeParameterTest(
                    "tuple(bool,string[3],bool)",
                    Arrays.asList(
                            true,
                            Arrays.asList("aaa", "bbb", "ccc"),
                            false
                    ),
                    "0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000000361616100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003626262000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036363630000000000000000000000000000000000000000000000000000000000"
            );

            decodeParameterTest(
                    "tuple(bool,string[],bool)",
                    Arrays.asList(
                            true,
                            Arrays.asList("aaa", "bbb", "ccc"),
                            false
                    ),
                    "00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000000361616100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003626262000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036363630000000000000000000000000000000000000000000000000000000000"
            );

            decodeParameterTest(
                    "tuple(bool,uint256[3],bool)",
                    Arrays.asList(
                            true,
                            Arrays.asList(111,222,333),
                            false
                    ),
                    "0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000006f00000000000000000000000000000000000000000000000000000000000000de000000000000000000000000000000000000000000000000000000000000014d0000000000000000000000000000000000000000000000000000000000000000"
            );

            decodeParameterTest(
                    "tuple(bool,uint256[],bool)",
                    Arrays.asList(
                            true,
                            Arrays.asList(111,222,333),
                            false
                    ),
                    "00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006f00000000000000000000000000000000000000000000000000000000000000de000000000000000000000000000000000000000000000000000000000000014d"
            );

            decodeParameterTest(
                    "tuple(string[3],bool)[]",
                    Arrays.asList(
                            Arrays.asList(
                                    Arrays.asList("aaa", "bbb", "ccc"),
                                    false
                            ),
                            Arrays.asList(
                                    Arrays.asList("ccc", "ddd", "fff"),
                                    false
                            )
                    ),

                    "00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000001a000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000036161610000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000362626200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003636363000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000000363636300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003646464000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036666660000000000000000000000000000000000000000000000000000000000"
            );

            decodeParameterTest(
                    "tuple(string[3],bool)[2]",
                    Arrays.asList(
                            Arrays.asList(
                                    Arrays.asList("aaa", "bbb", "ccc"),
                                    false
                            ),
                            Arrays.asList(
                                    Arrays.asList("ccc", "ddd", "fff"),
                                    false
                            )
                    ),

                    "0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000001a000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000036161610000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000362626200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003636363000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000000363636300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003646464000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036666660000000000000000000000000000000000000000000000000000000000"
            );

            decodeParameterTest(
                    "tuple(bool,uint256[3],bool)[]",
                    Arrays.asList(
                            Arrays.asList(
                                    true,
                                    Arrays.asList(111,222,333),
                                    false
                            ),
                            Arrays.asList(
                                    true,
                                    Arrays.asList(444,555,666),
                                    false
                            )
                    ),
                    "000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000006f00000000000000000000000000000000000000000000000000000000000000de000000000000000000000000000000000000000000000000000000000000014d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000001bc000000000000000000000000000000000000000000000000000000000000022b000000000000000000000000000000000000000000000000000000000000029a0000000000000000000000000000000000000000000000000000000000000000"
            );

        }

        @Test
        public void decodeParametersWithTuple() throws ClassNotFoundException, InvocationTargetException, NoSuchMethodException, InstantiationException, IllegalAccessException {
            decodeParametersTest(
                    Arrays.asList("tuple(address,address)", "tuple(string,string)", "bool"),
                    Arrays.asList(
                            Arrays.asList("0x1234567890123456789012345678901234567890", "0x1234567890123456789012345678901234567890"),
                            Arrays.asList("hello", "world"),
                            false
                    ),
                    "0000000000000000000000001234567890123456789012345678901234567890" +
                            "0000000000000000000000001234567890123456789012345678901234567890" +
                            "0000000000000000000000000000000000000000000000000000000000000080" +
                            "0000000000000000000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000040" +
                            "0000000000000000000000000000000000000000000000000000000000000080" +
                            "0000000000000000000000000000000000000000000000000000000000000005" +
                            "68656c6c6f000000000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000005" +
                            "776f726c64000000000000000000000000000000000000000000000000000000"
            );

            decodeParametersTest(
                    Arrays.asList("string", "tuple(uint256,string)", "bool", "tuple(bytes32,bytes)"),
                    Arrays.asList(
                            "the string",
                            Arrays.asList(56, "some string"),
                            true,
                            Arrays.asList("0x1234567890123456789012345678901234567890123456789012345678901234", "0x129581")
                    ),
                    "0000000000000000000000000000000000000000000000000000000000000080" +
                            "00000000000000000000000000000000000000000000000000000000000000c0" +
                            "0000000000000000000000000000000000000000000000000000000000000001" +
                            "0000000000000000000000000000000000000000000000000000000000000140" +
                            "000000000000000000000000000000000000000000000000000000000000000a" +
                            "74686520737472696e6700000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000038" +
                            "0000000000000000000000000000000000000000000000000000000000000040" +
                            "000000000000000000000000000000000000000000000000000000000000000b" +
                            "736f6d6520737472696e67000000000000000000000000000000000000000000" +
                            "1234567890123456789012345678901234567890123456789012345678901234" +
                            "0000000000000000000000000000000000000000000000000000000000000040" +
                            "0000000000000000000000000000000000000000000000000000000000000003" +
                            "1295810000000000000000000000000000000000000000000000000000000000"
            );

            decodeParametersTest(
                    Arrays.asList("bool",
                            "tuple(bool,tuple(bool,tuple(bool,bool)))",
                            "tuple(uint256,tuple(uint256,uint256,tuple(uint256,string)))",
                            "string"),
                    Arrays.asList(
                            true,
                            Arrays.asList(false, Arrays.asList(true, Arrays.asList(false, true))),
                            Arrays.asList(256, Arrays.asList(76, 67, Arrays.asList(1337, "hello"))),
                            "last param"
                    ),
                    "0000000000000000000000000000000000000000000000000000000000000001" +
                            "0000000000000000000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000001" +
                            "0000000000000000000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000001" +
                            "00000000000000000000000000000000000000000000000000000000000000e0" +
                            "0000000000000000000000000000000000000000000000000000000000000200" +
                            "0000000000000000000000000000000000000000000000000000000000000100" +
                            "0000000000000000000000000000000000000000000000000000000000000040" +
                            "000000000000000000000000000000000000000000000000000000000000004c" +
                            "0000000000000000000000000000000000000000000000000000000000000043" +
                            "0000000000000000000000000000000000000000000000000000000000000060" +
                            "0000000000000000000000000000000000000000000000000000000000000539" +
                            "0000000000000000000000000000000000000000000000000000000000000040" +
                            "0000000000000000000000000000000000000000000000000000000000000005" +
                            "68656c6c6f000000000000000000000000000000000000000000000000000000" +
                            "000000000000000000000000000000000000000000000000000000000000000a" +
                            "6c61737420706172616d00000000000000000000000000000000000000000000"
            );

            decodeParametersTest(
                    Arrays.asList("string", "tuple(string,string,tuple(string,string))", "bytes", "tuple(bytes,tuple(bytes,string))"),
                    Arrays.asList(
                            "hello world",
                            Arrays.asList("what", "is", Arrays.asList("even", "happening")),
                            "0x696e",
                            Arrays.asList("0x74686973", Arrays.asList("0x676f64666f7273616b656e", "test"))
                    ),
                    "0000000000000000000000000000000000000000000000000000000000000080" +
                            "00000000000000000000000000000000000000000000000000000000000000c0" +
                            "0000000000000000000000000000000000000000000000000000000000000260" +
                            "00000000000000000000000000000000000000000000000000000000000002a0" +
                            "000000000000000000000000000000000000000000000000000000000000000b" +
                            "68656c6c6f20776f726c64000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000060" +
                            "00000000000000000000000000000000000000000000000000000000000000a0" +
                            "00000000000000000000000000000000000000000000000000000000000000e0" +
                            "0000000000000000000000000000000000000000000000000000000000000004" +
                            "7768617400000000000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000002" +
                            "6973000000000000000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000040" +
                            "0000000000000000000000000000000000000000000000000000000000000080" +
                            "0000000000000000000000000000000000000000000000000000000000000004" +
                            "6576656e00000000000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000009" +
                            "68617070656e696e670000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000002" +
                            "696e000000000000000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000040" +
                            "0000000000000000000000000000000000000000000000000000000000000080" +
                            "0000000000000000000000000000000000000000000000000000000000000004" +
                            "7468697300000000000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000040" +
                            "0000000000000000000000000000000000000000000000000000000000000080" +
                            "000000000000000000000000000000000000000000000000000000000000000b" +
                            "676f64666f7273616b656e000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000004" +
                            "7465737400000000000000000000000000000000000000000000000000000000"
            );

            decodeParametersTest(
                    Arrays.asList(
                            "string",
                            "bool",
                            "tuple(string,tuple(tuple(bool,string,bool),tuple(string,bytes32,bytes)))",
                            "bytes",
                            "tuple(bool,tuple(bytes32,address),bytes)"),
                    Arrays.asList(
                            "this",
                            true,
                            Arrays.asList(
                                    "is",
                                    Arrays.asList(
                                            Arrays.asList(true, "utter", true),
                                            Arrays.asList("madness", "0x1234567890123456789012345678901234567890123456789012345678901234", "0x6275742049206c6f7665206974")
                                    )
                            ),
                            "0x6265636175736520697420776f726b73",
                            Arrays.asList(
                                    true,
                                    Arrays.asList("0x1234567890123456789012345678901234567890123456789012345678901234", "0x1337133713371337133713371337133713371337"),
                                    "0x6265636175736520697420776f726b736265636175736520697420776f726b73"
                            )
                    ),
                    "00000000000000000000000000000000000000000000000000000000000000a0" +
                            "0000000000000000000000000000000000000000000000000000000000000001" +
                            "00000000000000000000000000000000000000000000000000000000000000e0" +
                            "0000000000000000000000000000000000000000000000000000000000000320" +
                            "0000000000000000000000000000000000000000000000000000000000000360" +
                            "0000000000000000000000000000000000000000000000000000000000000004" +
                            "7468697300000000000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000040" +
                            "0000000000000000000000000000000000000000000000000000000000000080" +
                            "0000000000000000000000000000000000000000000000000000000000000002" +
                            "6973000000000000000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000040" +
                            "00000000000000000000000000000000000000000000000000000000000000e0" +
                            "0000000000000000000000000000000000000000000000000000000000000001" +
                            "0000000000000000000000000000000000000000000000000000000000000060" +
                            "0000000000000000000000000000000000000000000000000000000000000001" +
                            "0000000000000000000000000000000000000000000000000000000000000005" +
                            "7574746572000000000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000060" +
                            "1234567890123456789012345678901234567890123456789012345678901234" +
                            "00000000000000000000000000000000000000000000000000000000000000a0" +
                            "0000000000000000000000000000000000000000000000000000000000000007" +
                            "6d61646e65737300000000000000000000000000000000000000000000000000" +
                            "000000000000000000000000000000000000000000000000000000000000000d" +
                            "6275742049206c6f766520697400000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000010" +
                            "6265636175736520697420776f726b7300000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000001" +
                            "1234567890123456789012345678901234567890123456789012345678901234" +
                            "0000000000000000000000001337133713371337133713371337133713371337" +
                            "0000000000000000000000000000000000000000000000000000000000000080" +
                            "0000000000000000000000000000000000000000000000000000000000000020" +
                            "6265636175736520697420776f726b736265636175736520697420776f726b73"
            );

            decodeParametersTest(
                    Arrays.asList(
                            "tuple(string,tuple(bool,bool))",
                            "address",
                            "bytes",
                            "tuple(bytes,bytes,string,bool,address)",
                            "int256",
                            "tuple(int256,uint256,tuple(string,int256,address))"
                    ),
                    Arrays.asList(
                            Arrays.asList(
                                    "this is more reasonable",
                                    Arrays.asList(true, false)
                            ),
                            "0x1b3F5FE0Fd513E6cbdEE459F0b0e19095FE91958",
                            "0x6c6f6c6f6c6f6c6f6c",
                            Arrays.asList(
                                    "0xabcdef12345678",
                                    "0x87654321fedcba",
                                    "bazbar",
                                    false,
                                    "0xd13b6e9058E58B8677233CEc2315e1D9e77C79C4"
                            ),
                            -6,
                            Arrays.asList(
                                    -7, 5,
                                    Arrays.asList("foobar", -8, "0xB1eeF147028E9f480DbC5ccaA3277D417D1b85F0")
                            )
                    ),
                    "00000000000000000000000000000000000000000000000000000000000000c0" +
                            "0000000000000000000000001b3f5fe0fd513e6cbdee459f0b0e19095fe91958" +
                            "0000000000000000000000000000000000000000000000000000000000000160" +
                            "00000000000000000000000000000000000000000000000000000000000001a0" +
                            "fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa" +
                            "0000000000000000000000000000000000000000000000000000000000000300" +
                            "0000000000000000000000000000000000000000000000000000000000000060" +
                            "0000000000000000000000000000000000000000000000000000000000000001" +
                            "0000000000000000000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000017" +
                            "74686973206973206d6f726520726561736f6e61626c65000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000009" +
                            "6c6f6c6f6c6f6c6f6c0000000000000000000000000000000000000000000000" +
                            "00000000000000000000000000000000000000000000000000000000000000a0" +
                            "00000000000000000000000000000000000000000000000000000000000000e0" +
                            "0000000000000000000000000000000000000000000000000000000000000120" +
                            "0000000000000000000000000000000000000000000000000000000000000000" +
                            "000000000000000000000000d13b6e9058e58b8677233cec2315e1d9e77c79c4" +
                            "0000000000000000000000000000000000000000000000000000000000000007" +
                            "abcdef1234567800000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000007" +
                            "87654321fedcba00000000000000000000000000000000000000000000000000" +
                            "0000000000000000000000000000000000000000000000000000000000000006" +
                            "62617a6261720000000000000000000000000000000000000000000000000000" +
                            "fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff9" +
                            "0000000000000000000000000000000000000000000000000000000000000005" +
                            "0000000000000000000000000000000000000000000000000000000000000060" +
                            "0000000000000000000000000000000000000000000000000000000000000060" +
                            "fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8" +
                            "000000000000000000000000b1eef147028e9f480dbc5ccaa3277d417d1b85f0" +
                            "0000000000000000000000000000000000000000000000000000000000000006" +
                            "666f6f6261720000000000000000000000000000000000000000000000000000"
            );

            decodeParametersTest(
                    Arrays.asList(
                            "tuple(bytes32,bool,bytes32)",
                            "address",
                            "tuple(bytes32,bytes32,string)",
                            "tuple(tuple(address,bool),tuple(address,bytes32),tuple(int256,uint256))"
                    ),
                    Arrays.asList(
                            Arrays.asList(
                                    "0xffffffffffffffffffffffffffffffffabdef123849181759adebfadecaefbae",
                                    true,
                                    "0xffffffffffffffffffffffffffffffffabdef123849181759adebfadecaefbae"
                            ),
                            "0x1234567890123456789012345678901234567890",
                            Arrays.asList(
                                    "0x0ab3e6dfa1594c15af0000000000000000000000000000000000000000000000",
                                    "0xffffffffffffffffffffffffffffffffabdef123849181759adebfadecaefbae",
                                    "string"
                            ),
                            Arrays.asList(
                                    Arrays.asList("0x1234567890123456789012345678901234567890", true),
                                    Arrays.asList("0x1234567890123456789012345678901234567890", "0xffffffffffffffffffffffffffffffffabdef123849181759adebfadecaefbae"),
                                    Arrays.asList(-6124612, 89000)
                            )
                    ),
                    "ffffffffffffffffffffffffffffffffabdef123849181759adebfadecaefbae" +
                            "0000000000000000000000000000000000000000000000000000000000000001" +
                            "ffffffffffffffffffffffffffffffffabdef123849181759adebfadecaefbae" +
                            "0000000000000000000000001234567890123456789012345678901234567890" +
                            "0000000000000000000000000000000000000000000000000000000000000160" +
                            "0000000000000000000000001234567890123456789012345678901234567890" +
                            "0000000000000000000000000000000000000000000000000000000000000001" +
                            "0000000000000000000000001234567890123456789012345678901234567890" +
                            "ffffffffffffffffffffffffffffffffabdef123849181759adebfadecaefbae" +
                            "ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa28bbc" +
                            "0000000000000000000000000000000000000000000000000000000000015ba8" +
                            "0ab3e6dfa1594c15af0000000000000000000000000000000000000000000000" +
                            "ffffffffffffffffffffffffffffffffabdef123849181759adebfadecaefbae" +
                            "0000000000000000000000000000000000000000000000000000000000000060" +
                            "0000000000000000000000000000000000000000000000000000000000000006" +
                            "737472696e670000000000000000000000000000000000000000000000000000"
            );
        }

        @Test
        public void decodeParametersArrayType() throws ClassNotFoundException, InvocationTargetException, NoSuchMethodException, InstantiationException, IllegalAccessException {

            //fixed_static, fixed_static
            decodeParametersTest(
                Arrays.asList("bool[2]", "uint256[2]"),
                Arrays.asList(
                    Arrays.asList(true, false),
                    Arrays.asList(111, 222)
                ),
                "00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006f00000000000000000000000000000000000000000000000000000000000000de"
            );

            //var_dynamic, var_dynamic
            decodeParametersTest(
                Arrays.asList("bytes[][]", "string[][]"),
                Arrays.asList(
                    Arrays.asList(
                        Arrays.asList(
                            "abc".getBytes(StandardCharsets.UTF_8),
                            "def".getBytes(StandardCharsets.UTF_8)
                        ),
                        Arrays.asList(
                            "abc".getBytes(StandardCharsets.UTF_8),
                            "def".getBytes(StandardCharsets.UTF_8)
                        )
                    ),
                    Arrays.asList(
                        Arrays.asList("aaa", "bbb"),
                        Arrays.asList("ccc", "ddd")
                    )
                ),
                "000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000002600000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000001200000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003616263000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036465660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000361626300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003646566000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000012000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000036161610000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000362626200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003636363000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036464640000000000000000000000000000000000000000000000000000000000"
            );

            //fixed_static, fixed_dynamic, fixed_static, var_dynamic
            decodeParametersTest(
                Arrays.asList(
                    "bool[2]", "string[2]","uint256[2]", "string[]"
                ),
                Arrays.asList(
                    Arrays.asList(true, false),
                    Arrays.asList("aaa", "bbb"),
                    Arrays.asList(111, 222),
                    Arrays.asList("ccc", "ddd")
                ),
                "0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000006f00000000000000000000000000000000000000000000000000000000000000de00000000000000000000000000000000000000000000000000000000000001800000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000036161610000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000362626200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003636363000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036464640000000000000000000000000000000000000000000000000000000000"
            );

            //var_static, fixed_dynamic, var_static, fixed_dynamic
            decodeParametersTest(
                Arrays.asList(
                    "bool[]", "string[2]","uint256[]", "string[2]"
                ),
                Arrays.asList(
                    Arrays.asList(true, false),
                    Arrays.asList("aaa", "bbb"),
                    Arrays.asList(111, 222),
                    Arrays.asList("ccc", "ddd")
                ),
                "000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000001a000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000036161610000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000362626200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000006f00000000000000000000000000000000000000000000000000000000000000de000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000003636363000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000036464640000000000000000000000000000000000000000000000000000000000"
            );
        }
    }

    public static class decodeLog {
        @Test
        public void decodeLog() throws ClassNotFoundException {
            List<ContractIOType> ioTypeList= Arrays.asList(
                    new ContractIOType("from", "address", true),
                    new ContractIOType("to", "address", true),
                    new ContractIOType("value", "uint256", false)
            );

            List<String> topics = Arrays.asList(
                    "0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef",
                    "0x0000000000000000000000000000000000000000000000000000000000000000",
                    "0x0000000000000000000000002c8ad0ea2e0781db8b8c9242e07de3a5beabb71a"
            );

            String nonIndexedData = "0x00000000000000000000000000000000000000000000152d02c7e14af6800000";

            BigInteger decimals = BigInteger.valueOf(18);
            BigInteger value = BigInteger.valueOf(100_000).multiply(BigInteger.TEN.pow(decimals.intValue())); // 100000 * 10^18

            EventValues eventValues = caver.abi.decodeLog(ioTypeList, nonIndexedData, topics);

            assertEquals(eventValues.getIndexedValues().get(0).getValue(), "0x0000000000000000000000000000000000000000");
            assertEquals(eventValues.getIndexedValues().get(1).getValue(), "0x2c8ad0ea2e0781db8b8c9242e07de3a5beabb71a");
            assertEquals(eventValues.getNonIndexedValues().get(0).getValue(), value);
        }
    }

    public static class buildFunctionEventString {
        String TEST_ABI = "[{\"constant\":false,\"inputs\":[{\"name\":\"a\",\"type\":\"bytes32[]\"}],\"name\":\"h\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"components\":[{\"name\":\"a\",\"type\":\"uint256\"},{\"name\":\"b\",\"type\":\"uint256[]\"},{\"components\":[{\"name\":\"x\",\"type\":\"uint256\"},{\"name\":\"y\",\"type\":\"uint256\"}],\"name\":\"c\",\"type\":\"tuple[]\"}],\"name\":\"d\",\"type\":\"tuple[]\"}],\"name\":\"structArray\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"components\":[{\"name\":\"x\",\"type\":\"uint256\"},{\"name\":\"y\",\"type\":\"uint256\"}],\"name\":\"s\",\"type\":\"tuple\"}],\"name\":\"staticStruct\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"components\":[{\"name\":\"x\",\"type\":\"uint256\"},{\"name\":\"s\",\"type\":\"string\"}],\"name\":\"d\",\"type\":\"tuple\"}],\"name\":\"dynamicStruct\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"a\",\"type\":\"uint256\"}],\"name\":\"g\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"a\",\"type\":\"string\"}],\"name\":\"b\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"anonymous\":false,\"inputs\":[{\"components\":[{\"name\":\"x\",\"type\":\"uint256\"},{\"name\":\"y\",\"type\":\"uint256\"}],\"indexed\":true,\"name\":\"t\",\"type\":\"tuple\"}],\"name\":\"STRUCT_EVENT\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"t\",\"type\":\"uint256\"}],\"name\":\"EVENT\",\"type\":\"event\"}]";

//        pragma solidity >=0.4.19 <0.7.0;
//        pragma experimental caver.abiEncoderV2;
//
//        contract Test {
//            event STRUCT_EVENT(T indexed t);
//            event EVENT(uint256 indexed t);
//
//            struct S { uint a; uint[] b; T[] c; }
//            struct T { uint x; uint y; }
//            struct D { uint x; string s; }
//
//            function staticStruct(T memory s) public;
//            function dynamicStruct(D memory d) public;
//            function structArray(S[] memory d) public;
//            function g(uint a) public;
//            function b(string memory a) public;
//            function h(bytes32[] memory a) public;
//        }
        @Test
        public void buildFunctionStringTest() throws IOException {
            Contract contract = new Contract(caver, TEST_ABI);

            assertEquals("b(string)", caver.abi.buildFunctionString(contract.getMethod("b")));
            assertEquals("g(uint256)", caver.abi.buildFunctionString(contract.getMethod("g")));
            assertEquals("h(bytes32[])", caver.abi.buildFunctionString(contract.getMethod("h")));

            assertEquals("staticStruct((uint256,uint256))", caver.abi.buildFunctionString(contract.getMethod("staticStruct")));
            assertEquals("dynamicStruct((uint256,string))", caver.abi.buildFunctionString(contract.getMethod("dynamicStruct")));
            assertEquals("structArray((uint256,uint256[],(uint256,uint256)[])[])", caver.abi.buildFunctionString(contract.getMethod("structArray")));
        }

        @Test
        public void buildEventStringTest() throws IOException {
            Caver caver = new Caver(Caver.DEFAULT_URL);
            Contract contract = new Contract(caver, TEST_ABI);

            assertEquals("EVENT(uint256)", caver.abi.buildEventString(contract.getEvent("EVENT")));
            assertEquals("STRUCT_EVENT((uint256,uint256))", caver.abi.buildEventString(contract.getEvent("STRUCT_EVENT")));
        }
    }
}
